<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"/>
    <script
            src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        GET: $(document).ready(
            function () {
                // GET REQUEST
                $("#getALlBooks").click(function (event) {
                    event.preventDefault();
                    ajaxGet();
                });

                // SUBMIT FORM
                $("#bookForm").submit(function (event) {
                    // Prevent the form from submitting via the browser.
                    event.preventDefault();
                    ajaxPost();
                });

                //for tests
                function getclick() {
                    alert("Hello! I am an alert box!!");
                }

                // DO GET
                function ajaxGet() {
                    $.ajax({
                        type: "GET",
                        url: "getBooks",
                        success: function (result) {
                            if (result.status == "success") {
                                $('#getResultDiv ul').empty();
                                $.each(result.data,
                                    function (i, book) {

                                        var forTable = "<tr> <th scope=\"row\">" + book.id + " </th>" +
                                            "<td>" + book.title + "</td> " +
                                            "<td>" + book.author + "  </td>" +
                                            "<td>" + book.year + "</td> </tr>"
                                        $('#tbody').append(forTable)
                                    });
                                console.log("Success: ", result);
                            } else {
                                $("#getResultDiv").html("<strong>Error</strong>");
                                console.log("Fail: ", result);
                            }
                        },
                        error: function (e) {
                            $("#getResultDiv").html("<strong>Error</strong>");
                            console.log("ERROR: ", e);
                        }
                    });
                }

                // DO POST
                function ajaxPost() {

                    // PREPARE FORM DATA
                    var formData = {
                        year: $("#year").val(),
                        title: $("#title").val(),
                        author: $("#author").val()
                    }

                    $.ajax({
                        type: "POST",
                        contentType: "application/json",
                        url: "saveBook",
                        data: JSON.stringify(formData),
                        dataType: 'json',
                        success: function (result) {
                            if (result.status == "success") {
                                $("#postResultDiv").html(
                                    "" + result.data.title
                                    + "Post Successfully! <br>"
                                    + "---> Congrats !!" + "</p>");
                            } else {
                                $("#postResultDiv").html("<strong>Error</strong>");
                            }
                            console.log(result);
                        },
                        error: function (e) {
                            $("#postResultDiv").html("<strong>Error</strong>");
                            console.log("ERROR: ", e);
                        }
                    });
                }
            });
    </script>
    <title>Dashboard</title>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item active">
                <a class="nav-link" href="/dashboard" aria-disabled="true">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="addBook">Add book</a>
            </li>
        </ul>
        <a href="#" class="btn btn-outline-secondary  pull-right">Log out</a>
    </div>
</nav>


<h1 style="text-align: center">Dashboard</h1>
<div class="container">
    <div class="row">
        <div class="col">
            <div class="container">
                <div id="getResultDivForTable">
                    <table class="table table-sm table-striped">
                        <thead id="tthead">
                        <tr>
                            <th scope="col">Id</th>
                            <th scope="col">Title</th>
                            <th scope="col">Author</th>
                            <th scope="col">Year</th>
                        </tr>
                        </thead>
                        <tbody id="tbody">
                        </tbody>
                    </table>
                </div>

                <button id="getALlBooks" type="button" class="btn btn-primary">Get
                    All Books
                </button>
                <div id="getResultDiv"></div>
            </div>
        </div>
        <div class="col">
            <div class="container">
                <form class="row g-3 needs-validation" action="/dashboard" id="bookForm">
                    <div class="col-md-4">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" name="title" class="form-control" id="title" value="Title" required>
                    </div>
                    <div class="col-md-4">
                        <label for="author" class="form-label">Author</label>
                        <input type="text" name="author" class="form-control" id="author" value="Author" required>
                    </div>
                    <div class="col-md-4">
                        <label for="year" class="form-label">Year</label>
                        <input type="number" name="year" class="form-control" id="year" value="1900" required>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary " type="submit">Add</button>
                    </div>
                </form>
                <div id="postResultDiv"></div>
            </div>
        </div>

    </div>
</div>


<div class="container">


</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js"
        integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc"
        crossorigin="anonymous"></script>

</body>
</html>